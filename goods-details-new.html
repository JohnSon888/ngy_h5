<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <meta content="telephone=no" name="format-detection">
        <meta content="email=no" name="format-detection">
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no"> 
        <title></title>
        <link rel="stylesheet" href="css/main.css" />
        <link rel="stylesheet" href="css/demo.css">
        <link rel="stylesheet" href="css/own.css">
        <link rel="stylesheet" href="css/public.css">
        <link rel="stylesheet" type="text/css" href="css/swiper.css" />
        <script type="text/javascript" src="js/swiper.js"></script>
        <script type="text/javascript" src="js/jquery.min.js" ></script>
        <script type="text/javascript" src="js/flexible.js" ></script>
        <script type="text/javascript" src="src/lib/jquery/jquery.md5.js"></script>
        <script type="text/javascript" src="src/lib/common/common.js"></script>
        <script type="text/javascript" src="src/lib/common/farming.js"></script>
        <script type="text/javascript" src="src/lib/common/public.js"></script>
        <script type="text/javascript" src="src/lib/public/public.js"></script>
        <!-- layer -->
        <script type="text/javascript" src="src/lib/layer/layer.js" ></script>
        <!-- dropload -->
        <link rel="stylesheet" href="src/lib/zepto/dropload.css">
        <script type="text/javascript" src="src/lib/zepto/dropload.min.js"></script>
        <style type="text/css">
            .none-more-content{
                color: #868686;
                font-size: 14px;
                height: 2.86rem;
                line-height: 2.86rem;
                text-align: center;
            }
            .synthesis-dla {
                margin-bottom: 10px;
            }
            .syn-pa{line-height: normal;}
            .layer-work-pc select {text-indent:0.1rem;}
            .my-order-sate{margin-top: 1.3333rem;}
            .synthesis-main{z-index: 20;}
            .layer-work{z-index: 21}
            .layer-work-cont{z-index: 22;}
            .posin span{width: 50%;overflow: hidden;display: block;margin-left: 25%;}
            .work-deta-ul li{line-height: 22px;}
            .my-order-select li.fl{background: #dd1616; border: 1px solid #eb1c10;}
            .my-order-select li.fl a{color:white;}
            .cancel-order1{display:none;}
        </style>
        <script>
            $(function () {
                $(document).on('touchend', '.my-import', function (e) {
                    if (userid == 0) {
                        gotoLogin();
                    } else {
                        $('.layer-work').show();
                        $('.layer-work-cont').show();
                    }
                    e.preventDefault();
                })
                $('.layer-work').on('click', function () {
                    $('.layer-work').hide();
                    $('.layer-work-cont').hide();
                    document.activeElement.blur();
                })
                //轮播
                var mySwiper = new Swiper('.swiper-container', {
                    autoplay: 5000, //可选选项，自动滑动
                    pagination: '.swiper-pagination',
                    paginationClickable: true,
                })

                $('.import-a').on('keyup', function () {
                    if ($.trim($(this).val()).length > 0) {
                        $(this).parent().next().css('background', '#dd1616');
                        $(this).parent().next().removeClass('bb');
                        $(this).parent().next().addClass('aa');
                    } else {
                        $(this).parent().next().css('background', '#bbb');
                        $(this).parent().next().removeClass('aa');
                        $(this).parent().next().addClass('bb');
                    }
                });
               
            })
        </script>
    </head>
    <body>
        <section class="body-bj ovw" id="productDetail">
            <section class="header ovw posin" style="position:fixed;z-index:100;"><span></span><a href="javascript:;" class="header-back ovw"><img src="images/back.png"/></a>
                <!-- <a href="javascript:void(0);" class="header-reg goods-mark">关注</a> -->
                <a href="javascript:void(0);" class="header-reg goods-mark" style="right:1.3rem;"></a><!--  关注-->
                <a href="javascript:void(0);" class="header-reg goods-share"><img style="width: 22px;" src="images/share-button.png" /></a>
            </section>
            <div id="loop">
                <div class="swiper-container">
                    <div class="swiper-wrapper">

                    </div>
                    <div class="swiper-pagination"></div>
                </div>
            </div>
            <ul class="my-order-dete ovw p_info">

            </ul>
            <div class="p_tab">
                <ul>
                    <li><a class="touch">推荐商品</a></li>
                    <li><a>同类商品</a></li>
                </ul>
                <section class="release-near-content ovw p_info_con p_info_show similar-goods">
                    <!--推荐商品-->
                </section>
                <section class="release-near-content ovw p_info_con similar-merchant">
                    <!--同类商品-->
                </section>
            </div>
            <section class="synthesis-cont" style="margin-top:0.267rem;height:auto;">
                <article class="synthesis-main ovw goodsCommentList" style="overflow-y:scroll;position:static;height:auto;">
                    <!--  <cite class="synthesis-cite ovw">
                                         <label class="fl ovw">综合评分</label>
                                                 <p class="star-eval syn-t ovw fl">
                                                 <span class="fl star-a star"></span>
                                                 <span class="fl star-a star"></span>
                                                 <span class="fl star-a star"></span>
                                                 <span class="fl star-a"></span>
                                                 <span class="fl star-a"></span>
                                         </p> 		 
                                 </cite>
                    
                                 <dl class="synthesis-dla ovw">
                                 <dt><img src="images/order_1.png"/></dt>
                                         <dd>
                                         <div class="syn-personal ovw">
                                                         <p class="star-eval ovw fl">
                                                                 <span class="fl star-a star"></span>
                                                                 <span class="fl star-a star"></span>
                                                                 <span class="fl star-a star"></span>
                                                                 <span class="fl star-a"></span>
                                                                 <span class="fl star-a"></span>
                                                         </p>
                                                         <label class="fr">2017-01-05</label>
                                                 </div>
                                                 <p class="syn-pa ovw">...</p>
                                         </dd>
                                 </dl> -->
                </article>
            </section>
            <!---->
            <section class="layer-bj layer-work"></section>
            <section class="layer-work-cont ovw">
                <ul class="layer-work-mian ovw">
                    <li class="layer-work-lia">预定商品：</li>
                    <li class="layer-work-lie"><input class="goods_name" type="text" readonly="true"/></li>
                    <li class="layer-work-lia">数量：</li>
                    <li class="layer-work-lie"><input class="goods_num" type="number"/></li>
                    <li class="layer-work-lia">配送区域：</li>
                    <li class="layer-work-lic">
                        <p class="layer-work-pc ovw fl"><select class="layer-work-ce ovw province sf"><option areaID="0">省</option></select></p>
                        <p class="layer-work-pc layer-work-pd ovw fl"><select class="layer-work-ce ovw city cs"><option areaID="0">市</option></select></p>
                        <p class="layer-work-pc ovw fr"><select class="layer-work-ce ovw area qx"><option areaID="0">区县</option></select></p>
                    </li>
                    <li class="layer-work-lia">详细地址：</li>
                    <li class="layer-work-lie"><input class="cj_address" /></li>
                    <li class="layer-work-lif dg_submit"><a href="javascript:;">确认</a></li>
                </ul>
            </section>
        </section>
        <input type="hidden" value="0" class="merchant-userid"/>
        <input type="hidden" value="0" class="goods-type"/>
        <a class="info_btn" href="javascript:;" style="display:none;">
		<span>欢迎注册下载，惊喜等着你哦！&nbsp;&nbsp;马上注册</span>
		<img src="images/ret.png" alt="">
	</a>        <script type="text/javascript">
            // $(function(){
            setTimeout(function () {
                var searchContent = isNull(GetQueryParam("search_txt")) ? GetQueryParam("search_txt") : '';
                var goodsID = GetQueryParam("goodsID");
                //分享参数
                var shareImage = '';
                var shareText = '';
                var shareTitle = '';
                var shareURL = window.location.href+"&share=1&username="+username+"&userid="+userid;
                var share_params = GetQueryParam('share');
//                if(share_params==1){
//                    var share_name = GetQueryParam('username');
//                    var share_userid = GetQueryParam('userid');
//                    var phoneID = GetQueryParam('imei');
//                    var phoneModel = GetQueryParam('phoneModel');
//                    var addressIDs = GetQueryParam('address');
//                    $('.info_btn').attr('href','register.html?username='+share_name+'&userid='+share_userid+"&imei="+phoneID+"&phoneModel="+phoneModel+"&address="+addressIDs);
//                    $('.info_btn').show();
//                }
                var from = GetQueryParam('from');
                $('.header-back').on('click', function () {
                    if (from == "h5") {
                        //			window.location.href="my-work-4.html";
                        backtoPrev(0);
                    } else if (from == "order") {
                        //			window.location.href="my-order.html";
                        backtoPrev(0);
                    } else if (from == "concern") {
                        window.location.href = "my-subscription-1.html";
                    } else if (from == "merchant") {
                        window.history.back();  //返回上一页
                    } else {
                        //			window.location.href="shop-list.html?search_txt="+searchContent;
                        backtoPrev(0);
                    }
                })
                //				推荐商品切换
                $('#productDetail .p_tab li').each(function (i) {
                    $($('#productDetail .p_tab li')[i]).click(function () {
                        var $index = $(this).index();
                        $('#productDetail .p_tab li a').removeClass('touch');
                        $(this).find('a').addClass('touch');
                        $('#productDetail .p_info_con').removeClass('p_info_show');
                        $('#productDetail .p_info_con').eq($index).addClass('p_info_show');
//                        $('.dropload-down').siblings().remove();
                        if($index==1){
                            var goodsType = $('.goods-type').val();
                            var goodsListParams = {
                                    'type' : goodsType,//类型搜索,false
                                    'page': PAGE,
                                    'num': PAGE_NUM,
                            };
                            console.info(goodsListParams);
                            count = 0;
                            dropload.lock();
                            dropload.resetload();
                            $('.dropload-down').siblings().remove();
                            dropload_goodsList(goodsListParams);//获取商品
                        }else{
                            var merchantUserid = $('.merchant-userid').val();
                            var goodsListParams = {
                                    'userid' : merchantUserid,//类型搜索,false
                                    'page': PAGE,
                                    'num': PAGE_NUM,
                            };
                            console.info(goodsListParams);
                            goodsCount = 0;
                            dropload.lock();
                            dropload.resetload();
                            $('.dropload-down').siblings().remove();
                            dropload_machineList(goodsListParams);//获取商品
                        }
                    })
                })
                /*************消息通知消息状态处理****************/
                var messageID = GetQueryParam('messageID');
                if (from == 'notice') {
                    setTimeout(function () {
                        var notice_params = {
                            'messageID': messageID,
                            'userid': userid,
                        }
                        console.info(notice_params);
                        readMessage(notice_params);
                    }, 100);
                }
                //*********************************商品详情***********************************
                function goodsDetail(params) {
                    var cmd = 'goodsDetail';//商品详情接口命令
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var jsonp = 1;
                    params = objKeySort(params);//按照属性名升序排列
                    var params_str = objChangeStr(params);//拼接params参数的属性值
                    params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                    $.ajax({
                        url: apiURL, //接口地址
                        data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                        dataType: 'jsonp',
                        success: function (data) {
                            console.info(data);
                            if (isNull(data['body'])) {
                                //分享信息赋值
                                $('.header span').html(data['body']['goodsName']);
                                $('.merchant-userid').val(data['body']['userid']);
                                $('.goods-type').val(data['body']['typeID']);
                                var body = data['body'];
                                shareImage = body['userAvatar'];
                                shareText = body['intro'];
                                shareTitle = body['goodsName'];
                                switch (body['isFav']) {
                                    case '0':
                                        var image = '<img style="width:22px;" src="images/topic_3.png" isFav="' + body['isFav'] + '"/>';
                                        $('.goods-mark').append(image);
                                        break;
                                    case '1':
                                        var image = '<img style="width:22px;" src="images/topic_5.png" isFav="' + body['isFav'] + '"/>';
                                        $('.goods-mark').append(image);
                                        break;
                                }

                                var imagesHtml = '';
                                $.each(body['images'], function (i, val) {
                                    imagesHtml += '<div class="swiper-slide"><img src="' + val + '"><p class="bottom">' + data['body']['goodsName'] + '</p></div>';
                                })
                                $('.swiper-wrapper').append(imagesHtml);
                                //轮播
                                var mySwiper = new Swiper('.swiper-container', {
                                    autoplay: 5000, //可选选项，自动滑动
                                    pagination: '.swiper-pagination',
                                    paginationClickable: true,
                                })
                                //******************判断用户是否登录**************************************
                                var status = '';
                                var img = "images/ing_6.jpg";
                                var show_status = '<cite class="my-order-sate my-order-icona ovw" style="background: #fff url(' + img + ') no-repeat scroll 0.4rem center / auto 0.4666rem;">待接单</cite>';
                                switch (parseInt(data['body']['status'])) {
                                    case 5:
                                        img = "images/ing_7.jpg";
                                        //                                $('.edit').hide();
                                        //                                $('.cancel-delete-order').hide();
                                        show_status = '<cite class="my-order-sate my-order-icona ovw" style="background: #fff url(' + img + ') no-repeat scroll 0.4rem center / auto 0.4666rem;">已关闭</cite>';
                                        break;
                                }
                                var order_status = '';
                                if (userid == 0) {	//未登录状态
                                    order_status = '<section class="my-import ovw">购买</section>';
                                }
                                var imagesHtml = '';
                                $.each(body['images'], function (i, val) {
                                    imagesHtml += '<li class="add-pic-ld" style="float:left;width:25%;"><span class="fl plant-imgb ovw pic pic-add" style="margin:10px 7px;width:1.83rem;height:1.83rem;"><img src="' + val + '"></span></li>';
                                })
                                imagesHtml = "<div style='width:100%;border-top:1px solid #ececec;'><ul class='work-deta-ul'>" + imagesHtml + "</ul></div>";
                                switch (parseInt(data['body']['status'])) {
                                    case 2:
                                        img = "images/ing_8.jpg";
                                        show_status = '<cite class="my-order-sate my-order-icona ovw" style="background: #fff url(' + img + ') no-repeat scroll 0.4rem center / auto 0.4666rem;">进行中</cite>';
                                        break;
                                    case 3:
                                        img = "images/ing_8.jpg";
                                        show_status = '<cite class="my-order-sate my-order-icona ovw" style="background: #fff url(' + img + ') no-repeat scroll 0.4rem center / auto 0.4666rem;">进行中</cite>';
                                        break;
                                    case 4:
                                        img = "images/ing_7.jpg";
                                        show_status = '<cite class="my-order-sate my-order-icona ovw" style="background: #fff url(' + img + ') no-repeat scroll 0.4rem center / auto 0.4666rem;">已完成</cite>';
                                        break;
                                }
                                //****************************用户判断结束*****************************************
                                var cellPhone = isNull(data['body']['phone']) ? phone_replace(data['body']['phone']) : '暂无手机号';
                                //                            var comment_star = showStar(data['body']['average']);//星标评论
                                var comment_star = showStar(data['body']['grade']);
                                //                            var comment_star_num = comment_star+'<span class="fl num">('+data['body']['num']+')</span>';
                                var comment_star_num = comment_star + '<span class="fl num">(' + data['body']['commentCount'] + ')</span>';
                                var goodsDetailHtml = '<li><label class="my-order-dete-time ovw fl">价格：</label>' +
                                        '<p class="my-order-dete-pb ovw fl price">¥' + data['body']['price'] + '</p></li>' +
                                        '<li class="comments-lia">' +
                                        '<label class="my-order-dete-time ovw fl">评分： </label>' +
                                        '<p class="star-eval ovw">' + comment_star_num + '</p>' +
                                        '</li>' +
                                        '<li><label class="my-order-dete-time ovw fl">商户类型： </label>' +
                                        '<p class="my-order-dete-pb ovw fl">' + data['body']['merchantCate'] + '</p>' +
                                        '</li>' +
                                        '<li><label class="my-order-dete-time ovw fl">商户名称： </label>' +
                                        '<p class="my-order-dete-pb  ovw fl">' + data['body']['merchantName'] + '</p>' +
                                        '</li>' +
                                        '<li><label class="my-order-dete-time ovw fl">商户地址： </label>' +
                                        '<p class="my-order-dete-pb ovw fl">' + data['body']['merchantAddress'] + '</p>' +
                                        '</li>' +
                                        '<li><label class="my-order-dete-time ovw fl">商户电话： </label>' +
                                        '<a href="tel:'+body['merchantConcat']+'"><p class="my-order-dete-pb my-order-dete-num ovw fl">' + data['body']['merchantConcat'] + '</p></a>' +
                                        '</li>' +
                                        '<li><label class="my-order-dete-time ovw fl">商品介绍：</label>' +
                                        '<p class="my-order-dete-pb ovw fl">' + data['body']['intro'] + '</p>' +
                                        '</li>';
                                var syn_pa_html = data['body']['intro'];
                                $('.p_info').append(goodsDetailHtml + order_status);
                                $('.goods_name').val(data['body']['goodsName']);
                                $('.work-ok').css({'display': 'block'});

                            } else {
                                html = '<div class="none-more-content" style="height:200px;line-height:200px;background:white;margin-top:1.333rem;">暂无内容</div>';
                                $('.p_info').before(html);
                                $('.work-ok').css({'display': 'none'});
                            }
                            if (userid != data['body']['userid'] || userid == 0) {
                                var purchaseHtml = '<section class="my-import ovw">购买</section>';
                            } else {
                                var purchaseHtml = '';
                            }
                            $('.body-bj').append(purchaseHtml);
                            var merchantUserid = isNull(body['userid'])?body['userid']:0;
                            var params = {
                                    'userid': merchantUserid,
                                    'page': PAGE,
                                    'num': PAGE_NUM,
                                };
                            dropload_machineList(params);//获取商品
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg('网络请求延迟');
                            console.info(XMLHttpRequest.status);
                            console.info(XMLHttpRequest.readyState);
                            console.info(textStatus);
                        },
                    });
                }
                var params = {
                    'userid': userid,
                    'goodsID': goodsID,
                }
                goodsDetail(params);

                /******************************商品预定列表接口**********************************/
                function goodsReserveList(params, fd_userid, status, phone, isCommented) {//列表接口
                    var cmd = 'goodsReserveList';//接口命令
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var jsonp = 1;
                    console.info(params);
                    params = objKeySort(params);//按照属性名升序排列
                    var params_str = objChangeStr(params);//拼接params参数的属性值
                    params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                    $.ajax({
                        url: apiURL, //接口地址
                        data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                        dataType: 'jsonp',
                        success: function (data) {
                            console.info(data);
                            var order_status = '';
                            if (userid != 0) {
                                if (fd_userid == userid) {		//用户是发布人
                                    if (!isNull(data['body']['list'])) {	//暂无接单人
                                        $('.work-tel').attr('href', 'javascript:;');
                                        $('.work-tel').addClass('edit');
                                        $('.work-tel img').attr('src', 'images/edit_03.png');
                                        order_status = '';
                                        //		            		order_status = '<a class="over-order ovw cancel-delete-order" href="javascript:void(0);" style="background:none;border:1px solid #dd1616;color:#dd1616;">结束发布</a>';
                                    } else {	//有接单人
                                        var goodsReserveListHtml = '';
                                        var order_agree = '';
                                        var order_user = '';
                                        var order_refuse = '<cite class="my-order-sate ovw" style="text-indent: 0.5rem;font-weight:bolder;color:#333333;background:#ffffff;">被拒接单</cite>';
                                        var order_refuse_int = '';
                                        $.each(data['body']['list'], function (i, val) {
                                            if (parseInt(val['status']) == 2) {
                                                if (status == 4) {
                                                    var order_status2 = '<ul class="my-order-select ovw order-confirm" orderID="' + val['orderID'] + '" userid="' + val['userid'] + '" style="border-top: 1px solid #ececec;background: #ececec;"><a class="over-order ovw" href="javascript:void(0);"  userid="' + val['userid'] + '">该订单您已确认完成</a></ul>';
                                                } else if (status == 3) {
                                                    var order_status2 = '<ul class="my-order-select ovw order-confirm" orderID="' + val['orderID'] + '" userid="' + val['userid'] + '" style="border-top: 1px solid #ececec;background: #ececec;"><a class="over-order ovw order-over" href="javascript:void(0);"  userid="' + val['userid'] + '">确认完成</a></ul>';
                                                } else {
                                                    var order_status2 = '<ul class="my-order-select ovw order-confirm" orderID="' + val['orderID'] + '" userid="' + val['userid'] + '" style="border-top: 1px solid #ececec;background: #ececec;"><a class="over-order ovw" href="javascript:void(0);"  userid="' + val['userid'] + '">已同意</a></ul>';
                                                }
                                                order_agree = '<article class="my-order-content-b ovw"><dl class="my-order-content-dla ovw"><dt><div style="border-radius: 100%;height: 1.33rem;width: 1.33rem;overflow: hidden;float:left;"><img src="' + val['userAvatar'] + '" class="order-tx" style="height: auto;width:100%;border-radius: 0;"/></div><div class="fl"><p class="my-order-name ovw"><font class="fl ovw">' + val['username'] + '</font><img src="images/ing_5.png" class="fl"/></p><span class="my-order-name ovw">' + phone_replace(val['phone']) + '</span></div></dt><dd><a href="tel:' + val['phone'] + '"><img src="images/ing_3.png"/></a></dd></dl><ul class="work-deta-ul ovw" ><li><label class="fl ovw">预定时间：</label><span class="fl ovw">' + val['orderTime'] + '</span></li><li><label class="fl ovw">购买数量：</label><span class="fl ovw">' + val['count'] + '</span></li><li><label class="fl ovw">配送地址：</label><span class="fl ovw">' + val['address'] + '</span></li></ul>' + order_status2 + '</article>';
                                            } else if (parseInt(val['status']) == 1) {
                                                var str1 = "拒绝";
                                                var str2 = "同意";
                                                order_status2 = '<ul class="my-order-select ovw order-confirm" orderID="' + val['orderID'] + '" userid="' + val['userid'] + '" style="border-top: 1px solid #ececec;"><li class="fl refuse" yes_no="no"><a href="javascript:;">' + str1 + '</a></li><li class="fr agree" yes_no="yes"><a href="javascript:;">' + str2 + '</a></li></ul>';
                                                order_user += '<article class="my-order-content-b ovw"><dl class="my-order-content-dla ovw"><dt><div style="border-radius: 100%;height: 1.33rem;width: 1.33rem;overflow: hidden;float:left;"><img src="' + val['userAvatar'] + '" class="order-tx" style="height: auto;width:100%;border-radius: 0;"/></div><div class="fl"><p class="my-order-name ovw"><font class="fl ovw">' + val['username'] + '</font><img src="images/ing_5.png" class="fl"/></p><span class="my-order-name ovw">' + phone_replace(val['phone']) + '</span></div></dt><dd><a href="tel:' + val['phone'] + '"><img src="images/ing_3.png"/></a></dd></dl><ul class="work-deta-ul ovw" ><li><label class="fl ovw">预定时间：</label><span class="fl ovw">' + val['orderTime'] + '</span></li><li><label class="fl ovw">购买数量：</label><span class="fl ovw">' + val['count'] + '</span></li><li><label class="fl ovw">配送地址：</label><span class="fl ovw">' + val['address'] + '</span></li></ul>' + order_status2 + '</article>';
                                            } else {
                                                order_refuse_int = 1;
                                            }
                                        });
                                        $.each(data['body']['list'], function (i, val) {
                                            if (parseInt(val['status']) == 3) {
                                                switch (parseInt(val['status'])) {
                                                    case 1:
                                                        var str1 = "拒绝";
                                                        var str2 = "同意";
                                                        order_status1 = '<li class="fl refuse" yes_no="no"><a href="javascript:;">' + str1 + '</a></li><li class="fr agree" yes_no="yes"><a href="javascript:;">' + str2 + '</a></li>';
                                                        break;
                                                    case 3:
                                                        var str1 = "已拒绝";
                                                        var str2 = "同意";
                                                        // order_status1 = '<li class="fl refuse" yes_no="no"><a href="javascript:;">'+str1+'</a></li><li class="fr agree" yes_no="yes"><a href="javascript:;">'+str2+'</a></li>';break;
                                                        order_status1 = '';
                                                        break;
                                                        //		            					order_status1 = '<a class="over-order ovw" href="javascript:void(0);"  userid="'+val['userid']+'" style="background:gray;">已拒绝</a>';break;
                                                    case 2:
                                                        var str1 = "拒绝";
                                                        var str2 = "已同意";
                                                        // order_status1 = '<a class="over-order ovw order-over" href="javascript:void(0);"  userid="'+val['userid']+'">确认完成</a>';break;
                                                        //		            					if(status==4){
                                                        //		            						order_status1 = '<a class="over-order ovw" href="javascript:void(0);"  userid="'+val['userid']+'">该订单您已确认完成</a>';break;
                                                        //		            					}else if(status==3){
                                                        //		            						order_status1 = '<a class="over-order ovw order-over" href="javascript:void(0);"  userid="'+val['userid']+'">确认完成</a>';break;
                                                        //		            					}else{
                                                        //		            						order_status1 = '<a class="over-order ovw" href="javascript:void(0);"  userid="'+val['userid']+'">已同意</a>';break;
                                                        //		            					}
                                                }
                                                order_refuse += '<article class="my-order-content-b ovw" style="margin-bottom: 0.1333rem;margin-top:0;"><dl class="my-order-content-dla ovw"><dt><div style="border-radius: 100%;height: 1.33rem;width: 1.33rem;overflow: hidden;float:left;"><img src="' + val['userAvatar'] + '" class="order-tx" style="height: auto;width:100%;border-radius: 0;"/></div><div class="fl"><p class="my-order-name ovw"><font class="fl ovw">' + val['username'] + '</font><img src="images/ing_5.png" class="fl"/></p><span class="my-order-name ovw">' + phone_replace(val['phone']) + '</span></div></dt><dd><a href="tel:' + val['phone'] + '"><img src="images/ing_3.png"/></a></dd></dl><ul class="work-deta-ul ovw" ><li><label class="fl ovw">预定时间：</label><span class="fl ovw">' + val['orderTime'] + '</span></li><li><label class="fl ovw">购买数量：</label><span class="fl ovw">' + val['count'] + '</span></li><li><label class="fl ovw">配送地址：</label><span class="fl ovw">' + val['address'] + '</span></li></ul>' + order_status1 + '</article>';
                                            }
                                        });
                                        if (order_refuse_int == 1) {
                                            order_status = order_agree + order_user + order_refuse;
                                        } else {
                                            order_status = order_agree + order_user;
                                        }
                                    }
                                } else {//用户是接单人
                                    if (!isNull(data['body']['list'])) {	//暂无接单人
                                        order_status = '<section class="my-import ovw">购买</section>';
                                    } else {	//有接单人********在此判断订单状态*******
                                        var receivers = [];
                                        $.each(data['body']['list'], function (i, val) {
                                            receivers.push(parseInt(val['userid']));
                                        })
                                        // console.info(receivers);alert($.inArray(userid,receivers));
                                        if ($.inArray(userid, receivers) != -1) {	//本人已经接过单
                                            $.each(data['body']['list'], function (i, val) {
                                                if (userid == val['userid']) {
                                                    switch (parseInt(val['status'])) {
                                                        case 1:
                                                            order_status += '<article class="my-order-content-b ovw"><dl class="my-order-content-dla ovw"><dt><div style="border-radius: 100%;height: 1.33rem;width: 1.33rem;overflow: hidden;float:left;"><img src="' + val['userAvatar'] + '" class="order-tx" style="height: auto;width:100%;border-radius: 0;"/></div><div class="fl"><p class="my-order-name ovw"><font class="fl ovw">' + val['username'] + '</font><img src="images/ing_5.png" class="fl"/><span style="width: 100%;float: left;">' + phone_replace(val['phone']) + '</span></p><span class="my-order-name ovw"></span></div></dt></dl><ul class="work-deta-ul ovw" ><li><label class="fl ovw">预定时间：</label><span class="fl ovw">' + val['orderTime'] + '</span></li><li><label class="fl ovw">购买数量：</label><span class="fl ovw">' + val['count'] + '</span></li><li><label class="fl ovw">配送地址：</label><span class="fl ovw">' + val['address'] + '</span></li></ul><p class="my-order-content-pc ovw" style="border-top:1px solid #ececec;">您已接单请等待农户选择</p></article><a class="over-order ovw cancel-order" href="javascript:void(0);" orderID="' + val['orderID'] + '">取消订单</a><ul class="my-order-select ovw"><li class="fl message"><a href="sms:' + phone + '">发送短信</a></li><li class="fr phone"><a href="tel:' + phone + '">拨打电话</a></li></ul>';
                                                            break;
                                                        case 3:
                                                            order_status += '<article class="my-order-content-b ovw"><dl class="my-order-content-dla ovw"><dt><div style="border-radius: 100%;height: 1.33rem;width: 1.33rem;overflow: hidden;float:left;"><img src="' + val['userAvatar'] + '" class="order-tx" style="height: auto;width:100%;border-radius: 0;"/></div><div class="fl"><p class="my-order-name ovw"><font class="fl ovw">' + val['username'] + '</font><img src="images/ing_5.png" class="fl"/><span style="width: 100%;float: left;">' + phone_replace(val['phone']) + '</span></p><span class="my-order-name ovw"></span></div></dt></dl><ul class="work-deta-ul ovw" ><li><label class="fl ovw">预定时间：</label><span class="fl ovw">' + val['orderTime'] + '</span></li><li><label class="fl ovw">购买数量：</label><span class="fl ovw">' + val['count'] + '</span></li><li><label class="fl ovw">配送地址：</label><span class="fl ovw">' + val['address'] + '</span></li></ul><p class="my-order-content-pc ovw" style="border-top:1px solid #ececec;">您已接单农户已拒绝</p></article><a class="over-order ovw cancel-order1" orderID="' + val['orderID'] + '" href="javascript:void(0);" style="background:gray;">取消订单</a><ul class="my-order-select ovw"><li class="fl message"><a href="sms:' + phone + '">发送短信</a></li><li class="fr phone"><a href="tel:' + phone + '">拨打电话</a></li></ul>';
                                                            break;
                                                        case 2:
                                                            if (status == 4) {
                                                                if (isCommented == 0) {
                                                                    var goUrl = 'mac-comments.html?type=4&ownerID=' + fd_userid + '&commentId=' + goodsID;
                                                                    var isComment = "立即评价";
                                                                    var isComment_style = "style='display:block;'";
                                                                } else {
                                                                    var goUrl = "javascript:;";
                                                                    var isComment = "您已评价";
                                                                    var isComment_style = "style='display:none;'";
                                                                }
                                                                var my_status = '<a class="over-order ovw order-comment" href="' + goUrl + '" ' + isComment_style + '>' + isComment + '</a>';
                                                            } else {
                                                                if (status == 3) {
                                                                    var my_status = '<a class="over-order ovw" href="javascript:void(0);" orderID="' + val['orderID'] + '">已确认，等待用户确认</a>';
                                                                } else {
                                                                    var my_status = '<a class="over-order ovw confirm-order" href="javascript:void(0);" orderID="' + val['orderID'] + '">确认完成</a>';
                                                                }
                                                            }
                                                            order_status += '<article class="my-order-content-b ovw"><dl class="my-order-content-dla ovw"><dt><div style="border-radius: 100%;height: 1.33rem;width: 1.33rem;overflow: hidden;float:left;"><img src="' + val['userAvatar'] + '" class="order-tx" style="height: auto;width:100%;border-radius: 0;"/></div><div class="fl"><p class="my-order-name ovw"><font class="fl ovw">' + val['username'] + '</font><img src="images/ing_5.png" class="fl"/><span style="width: 100%;float: left;">' + phone_replace(val['phone']) + '</span></p><span class="my-order-name ovw"></span></div></dt></dl><ul class="work-deta-ul ovw" ><li><label class="fl ovw">预定时间：</label><span class="fl ovw">' + val['orderTime'] + '</span></li><li><label class="fl ovw">购买数量：</label><span class="fl ovw">' + val['count'] + '</span></li><li><label class="fl ovw">配送地址：</label><span class="fl ovw">' + val['address'] + '</span></li></ul><p class="my-order-content-pc ovw" style="border-top:1px solid #ececec;">您已接单农户已同意</p></article>' + my_status + '<ul class="my-order-select ovw"><li class="fl message"><a href="sms:' + phone + '">发送短信</a></li><li class="fr phone"><a href="tel:' + phone + '">拨打电话</a></li></ul>';
                                                            break;
                                                    }
                                                    return false;
                                                }
                                            })
                                        } else {	//本人暂未接单
                                            order_status = '<section class="my-import ovw">购买</section>';
                                        }

                                    }
                                }
                            }
                            $('.synthesis-cont').before(order_status);
                            if (status == 5) {
                                $('.edit').hide();
                                $('.cancel-delete-order').hide();
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg('网络请求延迟！');
                            console.info(XMLHttpRequest.status);
                            console.info(XMLHttpRequest.readyState);
                            console.info(textStatus);
                        },
                    });
                }

                /******************************商品预定接口**************************************/
                function goodsReserve(params) {//商品预定接口
                    var cmd = 'goodsReserve';//接口命令
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var jsonp = 1;
                    params = objKeySort(params);//按照属性名升序排列
                    var params_str = objChangeStr(params);//拼接params参数的属性值
                    params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                    $.ajax({
                        url: apiURL, //接口地址
                        data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                        dataType: 'jsonp',
                        success: function (data) {
                            console.info(data);
                            if (data['resultCode'] == 1) {
                                layer.msg('商品订购成功！');
                                $('.dg_submit').addClass('dg_sure');
                                setTimeout(function () {
                                    window.location.reload();
                                }, 500);
                            } else {
                                layer.msg('商品订购失败！');
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg('网络请求延迟！');
                            console.info(XMLHttpRequest.status);
                            console.info(XMLHttpRequest.readyState);
                            console.info(textStatus);
                        },
                    });
                }

                $('.dg_submit').on('click', function () {
                    var count = $.trim($('.goods_num').val());
                    var province = $('.sf option:selected').attr('areaID');
                    var city = $('.cs option:selected').attr('areaID');
                    var area = $('.qx option:selected').attr('areaID');
                    var address = $.trim($('.cj_address').val());
                    if (!isNull(count) || count == 0 || isNaN(count)) {
                        layer.msg('请填写商品数量!');
                        return false;
                    }
                    if (province == 0) {
                        layer.msg('请完整填写配送区域!');
                        return false;
                    }
                    if (city == 0) {
                        layer.msg('请完整填写配送区域!');
                        return false;
                    }
                    if (area == 0) {
                        layer.msg('请完整填写配送区域!');
                        return false;
                    }
                    if (!isNull(address)) {
                        layer.msg('请填写详细地址!');
                        return false;
                    }
                    var goodsReserve_params = {
                        'goodsID': goodsID,
                        'userid': userid,
                        'count': count,
                        'province': province,
                        'city': city,
                        'area': area,
                        'address': address,
                    }
                    if ($('.dg_sure').length == 0) {
                        goodsReserve(goodsReserve_params);
                    }
                });




                /******************************获取省市区接口***********************/
                function getArea(areaID, type) {//获取省市区接口
                    var cmd = 'getArea';//接口命令
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var jsonp = 1;
                    var params = {
                        'areaID': areaID,
                    };
                    params = objKeySort(params);//按照属性名升序排列
                    var params_str = objChangeStr(params);//拼接params参数的属性值
                    params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                    $.ajax({
                        url: apiURL, //接口地址
                        data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                        dataType: 'jsonp',
                        success: function (data) {
                            if (isNull(data['body']['list'])) {
                                console.info(data);
                                var areaHtml = '';
                                $.each(data['body']['list'], function (i, val) {
                                    areaHtml += '<option areaID="' + val['areaID'] + '">' + val['areaName'] + '</option>';
                                })
                                switch (type) {
                                    case 1:
                                        $('.sf').append(areaHtml);
                                        break;
                                    case 2:
                                        $('.cs').append(areaHtml);
                                        break;
                                    case 3:
                                        $('.qx').append(areaHtml);
                                        break;
                                }
                            } else {
                                layer.msg('暂无区域内容');
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg('网络请求延迟！');
                            console.info(XMLHttpRequest.status);
                            console.info(XMLHttpRequest.readyState);
                            console.info(textStatus);
                        },
                    });
                }
                getArea(0, 1);
                $('.sf').on('change', function () {
                    if ($('.sf option:selected').attr('areaID') != 0) {
                        $('.cs').html('');
                        $('.cs').append('<option areaID="0">城市</option>');
                        $('.qx').html('');
                        $('.qx').append('<option areaID="0">区县</option>');
                        getArea($('.sf option:selected').attr('areaID'), 2);
                    } else {
                        $('.cs').html('<option areaID="0">城市</option>');
                        $('.qx').html('<option areaID="0">区县</option>');
                    }
                })
                $('.cs').on('change', function () {
                    if ($('.cs option:selected').attr('areaID') != 0) {
                        $('.qx').html('');
                        $('.qx').append('<option areaID="0">区县</option>');
                        getArea($('.cs option:selected').attr('areaID'), 3);
                    } else {
                        // $('.cs').html('<option areaID="0">请选择城市</option>');
                        $('.qx').html('<option areaID="0">区县</option>');
                    }
                })

                //************************************评论列表接口********************
                function goodsCommentList(params) {
                    var cmd = 'commentList';//农机手评论列表接口命令
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var jsonp = 1;
                    var up = 1;//默认是上拉
                    if (params.page == 0) {
                        up = 0;
                        count = 0;
                        params.page = 1;
                    }
                    params = objKeySort(params);//按照属性名升序排列
                    var params_str = objChangeStr(params);//拼接params参数的属性值
                    params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                    $.ajax({
                        url: apiURL, //接口地址
                        data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                        dataType: 'jsonp',
                        success: function (data) {
                            console.info(data);
                            if (isNull(data['body']['list'])) {
                                var comment_star = showStar(data['body']['average']);//星标评论
                                var goodsComment = '';

                                var goodsCommentListHtml = goodsComment;
                                $.each(data['body']['list'], function (i, val) {
                                    var comment_list_star = showStar(val['score']);//星标评论
                                    goodsCommentListHtml += '<dl class="synthesis-dla ovw"><dt style="border-radius: 100%;height: 1.33rem;width: 1.33rem;overflow: hidden;"><img src="' + val['userAvatar'] + '" style="height: auto;width:100%;border-radius: 0;"/></dt><dd><div class="syn-personal ovw"><p class="star-eval ovw fl">' + comment_list_star + '</p><label class="fr">' + val['commentTime'] + '</label></div><p class="syn-pa ovw">' + val['content'] + '</p></dd></dl>';
                                    count++;
                                })
                                if (count <= 10) {
                                    goodsCommentListHtml = '<cite class="my-order-sate ovw" style="text-indent: 0.5rem;font-weight:bolder;color:#333333;margin-top:0;">评价</cite><cite class="synthesis-cite ovw" style="padding-bottom: 10px;border-bottom: 1px solid #ececec;"><label class="fl ovw">综合评分</label><p class="star-eval syn-t ovw fl">' + comment_star + '</p></cite>' + goodsCommentListHtml;
                                } else {
                                    goodsCommentListHtml = goodsCommentListHtml;
                                }
                            } else {
                                if ((count != 0)) {//上拉加载无内容锁定无数据
                                    dropload.resetload();
                                    dropload.lock();
                                    dropload.noData();
                                    $('.dropload-down').hide();
                                } else {
                                    // html = '<div class="none-more-content">暂无内容</div>';
                                    // $('.goodsCommentList').html(html);
                                    // return false;
                                    dropload.resetload();
                                    dropload.noData();
                                    dropload.lock();
                                    $('.dropload-down').hide();
                                }
                            }
                            setTimeout(function () {
                                $('.none-more-content').remove();
                                if (up == 0) {//下拉加载
                                    $('.goodsCommentList').html('');
                                    dropload_goodsCommentList(goodsCommentList_params);
                                    //	                    	if(count<((params.page)*params.num)&&count!=0){
                                    //	                            goodsCommentListHtml += '<div class="dropload-down"><div class="dropload-noData">加载完成</div></div>'; 
                                    //	                            $('.goodsCommentList').html(goodsCommentListHtml);	
                                    //	                         }else{
                                    //	                         	$('.goodsCommentList').html(goodsCommentListHtml);	
                                    //	                         	goodsCommentList(msgList_params);
                                    //	                         }
                                    //	                    	dropload.resetload();
                                    //	                        dropload.unlock();// 解锁loadDownFn里锁定的情况
                                    //	                        dropload.noData(false);
                                    //	                        $('.dropload-down').hide();
                                    //	                        params.page = 2;// 重置页数，重新获取loadDownFn的数据
                                } else {
                                    if (count < ((params.page) * params.num)) {
                                        dropload.lock();// 锁定
                                        dropload.noData();// 无数据
                                        $('.dropload-down').hide();
                                    }
                                    $('.dropload-down').before(goodsCommentListHtml);
                                    dropload.resetload();// 每次数据加载完，必须重置
                                }
                            }, 500);
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg('网络请求延迟！');
                            console.info(XMLHttpRequest.status);
                            console.info(XMLHttpRequest.readyState);
                            console.info(textStatus);
                        },
                    });
                }
                //*********************************评论列表上拉加载*****************
                function dropload_goodsCommentList(params) {
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var time = toLocalTime(ts, 6);
                    dropload = $('.goodsCommentList').dropload({
                        scrollArea: window,
                        domUp: {
                            domClass: 'dropload-up',
                            domRefresh: '<div class="dropload-refresh"><p style="height:20px;">↓下拉刷新</p><p style="color:#666">上次更新:' + time + '</p></div>',
                            domUpdate: '<div class="dropload-update"><p style="height:20px;">↑释放更新</p><p style="color:#666">上次更新:' + time + '</p></div>',
                            domLoad: '<div class="dropload-load"><span class="loading"></span>刷新中...</div>'
                        },
                        domDown: {
                            domClass: 'dropload-down',
                            domRefresh: '<div class="dropload-refresh"></div>',
                            domLoad: '<div class="dropload-load"><span class="loading"></span>加载中...</div>',
                            domNoData: '<div class="dropload-noData">已加载全部数据</div>'
                        },
                        loadUpFn: function (me) {
                            //下拉刷新
                            params.page = 0;
                            goodsCommentList(params)
                            params.page = 1;
                        },
                        loadDownFn: function (me) {
                            //上拉加载
                            goodsCommentList(params)
                            params.page++;
                        },
                        threshold: 50
                    });
                }
                var count = 0;
                var goodsCommentList_params = {
                    'infoID': goodsID, //信息ID
                    'infoType': 4, //1农机；2农活；3零活；4商品；5零工；6二手
                    'page': PAGE,
                    'num': PAGE_NUM,
                };
                // dropload_goodsCommentList(goodsCommentList_params);//加载农机手评论列表

                //**********************************商品关注***************************
                $(document).on('touchend', '.goods-mark', function () {
                    if (userid == 0) {
                        gotoLogin();
                    } else {
                        var is_mark = parseInt($('.goods-mark img').attr('isFav'));
                        switch (is_mark) {
                            case 0:  		//关注
                                var goodsMark_params = {
                                    'userid': userid,
                                    'id': goodsID,
                                    'type': 4, //1农机；2农活；3零活；4商品；5圈子；6零工；7二手
                                };
                                mark(goodsMark_params);
                                $('.goods-mark img').attr('src', 'images/topic_5.png');
                                $('.goods-mark img').attr('isFav', 1);
                                break;
                            case 1:  		//取消关注
                                var goodsUnMark_params = {
                                    'userid': userid,
                                    'id': goodsID,
                                    'type': 4, //1农机；2农活；3零活；4商品；5圈子；6零工；7二手
                                };
                                UnMark(goodsUnMark_params);
                                $('.goods-mark img').attr('src', 'images/topic_3.png');
                                $('.goods-mark img').attr('isFav', 0);
                                break;
                        }
                    }
                });

                //**********************************商品分享***************************
                $('.goods-share').on('touchend', function () {
//                    shareURL += "&imei="+phoneIMEI+"&phoneModel="+phoneModels+"&address="+current_location_areaIDs;
                    if (userid != 0) {
                        share(shareImage, shareText, shareTitle, shareURL);
                    } else {
                        gotoLogin();
                    }
                });

                //*********************************商品预定订单同意接口***********************************
                function goodsAccept(params) {
                    var cmd = 'goodsAccept';//接口命令
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var jsonp = 1;
                    params = objKeySort(params);//按照属性名升序排列
                    var params_str = objChangeStr(params);//拼接params参数的属性值
                    params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                    $.ajax({
                        url: apiURL, //接口地址
                        data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                        dataType: 'jsonp',
                        success: function (data) {
                            if (data['resultCode'] == 1) {
                                layer.msg("该订单已同意!");
                                setTimeout(function () {
                                    window.location.reload();
                                }, 1000);
                            } else {
                                layer.msg("订单同意失败，系统出错!");
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg('网络请求延迟！');
                            console.info(XMLHttpRequest.status);
                            console.info(XMLHttpRequest.readyState);
                            console.info(textStatus);
                        },
                    });
                }
                //*********************************商品预定订单拒绝接口***********************************
                function goodsRefuse(params) {
                    var cmd = 'goodsRefuse';//接口命令
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var jsonp = 1;
                    params = objKeySort(params);//按照属性名升序排列
                    var params_str = objChangeStr(params);//拼接params参数的属性值
                    params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                    $.ajax({
                        url: apiURL, //接口地址
                        data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                        dataType: 'jsonp',
                        success: function (data) {
                            if (data['resultCode'] == 1) {
                                layer.msg("该订单已拒绝!");
                                setTimeout(function () {
                                    window.location.reload();
                                }, 1000);
                            } else {
                                layer.msg("订单拒绝失败，系统出错!");
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg('网络请求延迟！');
                            console.info(XMLHttpRequest.status);
                            console.info(XMLHttpRequest.readyState);
                            console.info(textStatus);
                        },
                    });
                }
                /*****************************发单人同意或拒绝商品预定****************************************/
                $(document).on('touchend', '.order-confirm li', function () {
                    var yes_no = $(this).attr('yes_no');
                    var orderID = $(this).parent('.order-confirm').attr('orderID');
                    if (yes_no == "yes") {
                        layer.open({
                            content: '该订单同意后是否重新发布消息？'
                            , btn: ['是', '否']
                            , yes: function (index) {
                                layer.close(index);
                                var yes_no_params = {
                                    'userid': userid,
                                    'goodsID': goodsID,
                                    'orderID': orderID,
                                    'add': 1,
                                };
                                goodsAccept(yes_no_params);
                            }, btn2: function (index) {
                                layer.close(index);
                                var yes_no_params = {
                                    'userid': userid,
                                    'goodsID': goodsID,
                                    'orderID': orderID,
                                    'add': 0,
                                };
                                goodsAccept(yes_no_params);
                            }
                        });
                        // machAccept(yes_no_params);
                    } else {
                        var yes_no_params = {
                            'userid': userid,
                            'goodsID': goodsID,
                            'orderID': orderID,
                        };
                        goodsRefuse(yes_no_params);
                    }
                })



                //*********************************商品取消预定接口***********************************
                function goodsCancelReserve(params) {
                    var cmd = 'goodsCancelReserve';//商品取消预定接口
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var jsonp = 1;
                    params = objKeySort(params);//按照属性名升序排列
                    var params_str = objChangeStr(params);//拼接params参数的属性值
                    params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                    $.ajax({
                        url: apiURL, //接口地址
                        data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                        dataType: 'jsonp',
                        success: function (data) {
                            console.info(data);
                            if (data['resultCode'] == 1) {
                                layer.msg("商品成功取消预定!");
                                setTimeout(function () {
                                    window.location.reload();
                                }, 1000);
                            } else {
                                layer.msg("商品取消预定失败，系统出错!");
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg('网络请求延迟！');
                            console.info(XMLHttpRequest.status);
                            console.info(XMLHttpRequest.readyState);
                            console.info(textStatus);
                        },
                    });
                }
                $(document).on('click', '.cancel-order', function () {
                    var orderID = $('.cancel-order').attr('orderID');
                    var goodsCancelReserve_params = {
                        'userid': userid,
                        'orderID': orderID,
                    };
                    goodsCancelReserve(goodsCancelReserve_params);
                })

                /****************************接单人商品订单确认接口******************************/
                function goodsConfirm(params) {
                    var cmd = 'goodsConfirm';//接单人农机订单确认接口
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var jsonp = 1;
                    params = objKeySort(params);//按照属性名升序排列
                    var params_str = objChangeStr(params);//拼接params参数的属性值
                    params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                    $.ajax({
                        url: apiURL, //接口地址
                        data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                        dataType: 'jsonp',
                        success: function (data) {
                            console.info(data);
                            if (data['resultCode'] == 1) {
                                layer.msg("该订单已确认完成!");
                                $('.confirm-order').html('已确认，等待用户确认');
                            } else {
                                layer.msg("商品确认完成失败，系统出错!");
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg('网络请求延迟！');
                            console.info(XMLHttpRequest.status);
                            console.info(XMLHttpRequest.readyState);
                            console.info(textStatus);
                        },
                    });
                }
                /*********************************发布人商品订单完成接口***************************/
                function goodsComplete(params) {
                    var cmd = 'goodsComplete';//接口命令
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var jsonp = 1;
                    params = objKeySort(params);//按照属性名升序排列
                    var params_str = objChangeStr(params);//拼接params参数的属性值
                    params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                    $.ajax({
                        url: apiURL, //接口地址
                        data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                        dataType: 'jsonp',
                        success: function (data) {
                            console.info(data);
                            if (data['resultCode'] == 1) {
                                layer.msg("该订单已确认完成!");
                                $('.order-over').html("该订单您已确认完成");
                                $('.my-order-sate').css('background', '#fff url(images/ing_7.jpg) no-repeat scroll 0.4rem center / auto 0.4666rem');
                                $('.my-order-sate').html("已完成");
                            } else {
                                layer.msg("订单确认完成失败，系统出错!");
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg('网络请求延迟！');
                            console.info(XMLHttpRequest.status);
                            console.info(XMLHttpRequest.readyState);
                            console.info(textStatus);
                        },
                    });
                }
                //接单人确认
                $(document).on('click', '.confirm-order', function () {
                    var orderID = $('.confirm-order').attr('orderID');
                    var goodsConfirm_params = {
                        'userid': userid,
                        'orderID': orderID,
                    };
                    goodsConfirm(goodsConfirm_params);
                })
                //发布人确认
                $(document).on('click', '.order-over', function () {
                    var goodsComplete_params = {
                        'userid': userid,
                        'goodsID': goodsID,
                    };
                    goodsComplete(goodsComplete_params);
                })

                /****************************商品取消发布接口******************************/
                function goodsRevoke(params) {
                    var cmd = 'goodsRevoke';//商品取消发布接口
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var jsonp = 1;
                    params = objKeySort(params);//按照属性名升序排列
                    var params_str = objChangeStr(params);//拼接params参数的属性值
                    params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                    $.ajax({
                        url: apiURL, //接口地址
                        data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                        dataType: 'jsonp',
                        success: function (data) {
                            console.info(data);
                            if (data['resultCode'] == 1) {
                                layer.msg("商品取消发布成功!");
                                setTimeout(function () {
                                    if (from == "h5") {
                                        backtoPrev(1);
                                        //                            window.location.href = 'http://'+window.location.host+'/my-work-4.html';
                                    } else {
                                        window.location.href = 'http://' + window.location.host + '/shop-list.html';
                                    }
                                }, 1000);
                            } else {
                                layer.msg(data['resultMessage']);
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg('网络请求延迟！');
                            console.info(XMLHttpRequest.status);
                            console.info(XMLHttpRequest.readyState);
                            console.info(textStatus);
                        },
                    });
                }
                $(document).on('click', '.cancel-delete-order', function () {
                    layer.open({
                        content: '您确定要结束发布吗？'
                        , btn: ['是', '否']
                        , yes: function (index) {
                            var goodsRevoke_params = {
                                'userid': userid,
                                'goodsID': goodsID,
                            };
                            goodsRevoke(goodsRevoke_params);
                        }
                    });

                })
                //************************************发布人编辑发布消息********************
                $(document).on('touchend', '.edit', function () {
                    if (userid == 0) {
                        gotoLogin();
                    } else {
                        window.location.href = "goods-release.html?from=details&goodsID=" + goodsID;
                    }
                })
               
                //*********************************我的商品列表上拉加载*****************
                function dropload_machineList(params) {
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var time = toLocalTime(ts, 6);//下拉时间定义
                    dropload = $('.p_info_show').dropload({
                        scrollArea: window,
                        domUp: {
                            domClass: 'dropload-up',
                            domRefresh: '<div class="dropload-refresh"><p style="height:20px;">↓下拉刷新</p><p style="color:#666">上次更新:' + time + '</p></div>',
                            domUpdate: '<div class="dropload-update"><p style="height:20px;">↑释放更新</p><p style="color:#666">上次更新:' + time + '</p></div>',
                            domLoad: '<div class="dropload-load"><span class="loading"></span>刷新中...</div>'
                        },
                        domDown: {
                            domClass: 'dropload-down',
                            domRefresh: '<div class="dropload-refresh"></div>',
                            domLoad: '<div class="dropload-load"style="background:#fff"><span class="loading"></span>加载中...</div>',
                            domNoData: '<div class="dropload-noData" style="background:#fff">已加载全部数据</div>'
                        },
                        loadUpFn: function (me) {
                            //下拉刷新
                            params.page = 0;
                            get_myGoods(params);
                            params.page = 1;
                        },
                        loadDownFn: function (me) {
                            //上拉加载
                            get_myGoods(params);
                            params.page++;
                        },
                        threshold: 50
                    });
                }
/*****************************************同类型商品搜索列表*****************************/
            var count = 0;
            function goodsList(params) {
                var cmd = 'goodsList';//商品搜索列表接口命令
                var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                var jsonp = 1;
                var up = 1;//默认是上拉
                if (params.page == 0) {
                    up = 0;
                    count = 0;
                    params.page = 1;
                }
                params = objKeySort(params);//按照属性名升序排列
                var params_str = objChangeStr(params);//拼接params参数的属性值
                params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                $.ajax({
                    url: apiURL, //接口地址
                    data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                    dataType: 'jsonp',
                    success: function (data) {
                        if (isNull(data['body']['list'])) {
                            var goodsListHtml = '';
                            $.each(data['body']['list'], function (i, val) {
                                if(goodsID!=val['goodsID']){
                                var comment_star = showStar(val['grade']);//星标评论
                                var goods_price = isNaN(parseFloat(val['goodsPrice']).toFixed(2)) ? 0 : parseFloat(val['goodsPrice']).toFixed(2);//goods-details.html?goodsID=' + val['goodsID'] + '&search_txt='+searchContent+'
                                goodsListHtml += '<article class="release-near-art ovw"><a href="javascript:;" class="goods-detail" goodsID="'+ val['goodsID']+'">' +
                                        '<dl class="release-near-dl ovw">' +
                                        '<dt><div style="border-radius: 100%;height: 1.33rem;width: 1.33rem;overflow: hidden;"><img src="' + val['poster'] + '" style="height: auto;width:100%;border-radius: 0;"/></div><span class="rele-near-name fl ovw">' + val['publisherName'] + '</span></dt>' +
                                        '<dd>' +
                                        '<div class="rele-near-dete ovw">' +
                                        '<div class="near-discuse ovw fl">' +
                                        '<p class="star-eval ovw fr">' + comment_star +
                                        '</p>' +
                                        '<cite class="fr">评价:</cite>' +
                                        '</div>' +
                                        '</div>' +
                                        '<p class="near-pa ovw">' +
                                        '<label class="fl">发布时间：</label>' +
                                        '<span class="fl">' + val['timeline'] + '</span>' +
                                        '</p>' +
                                        '<p class="near-pa ovw sp">' +
                                        '<label class="fl">商品：</label>' +
                                        '<span class="fl">' + val['goodsType'] + '</span>' +
                                        '</p>' +
                                        '<p class="near-pa ovw sp">' +
                                        '<label class="fl">价格：￥</label>' +
                                        '<span class="fl">' + val['goodsPrice'] + '</span>' +
                                        '</p>' +
                                        '</dd>' +
                                        '</dl>' +
                                        '</a></article>';
                                count++;
                                }else{
                                    if(data['body']['list'].length==1){
                                        goodsListHtml = '<div class="none-more-content" style="background: white;">暂无内容</div>';
                                    }else{
                                        goodsListHtml += '';
                                    }
                                }
                            })
                        } else {
                            sign=0;
                            if ((count != 0)) {//上拉加载无内容锁定无数据
                                dropload.resetload();
                                dropload.lock();
                                dropload.noData();
                                $('.dropload-down').hide();
                            } else {
                                html = '<div class="none-more-content">暂无内容</div>';
                                $('.dropload-down').siblings().remove();
                                $('.dropload-down').before(html);
                                dropload.resetload();
                                dropload.lock();
                                dropload.noData();
                                $('.dropload-down').hide();
                                return false;
                            }
                        }
                        // 为了测试，延迟1秒加载
                        setTimeout(function () {
                            $('.none-more-content').remove();
                            if (up == 0) {//下拉加载
                                if (count < ((params.page) * params.num) && count != 0) {
                                    goodsListHtml += '<div class="dropload-down"><div class="dropload-noData" style="display:none;">加载完成</div></div>';
                                    $('.similar-merchant').html(goodsListHtml);
                                } else {
                                    $('.similar-merchant').html(goodsListHtml);
                                    dropload_goodsList(params);
                                }
                                dropload.resetload();
                                dropload.unlock();// 解锁loadDownFn里锁定的情况
                                // dropload.noData(false);
                                $('.dropload-down').hide();
                                params.page = 2;// 重置页数，重新获取loadDownFn的数据
                            } else {
                                if (count < ((params.page) * params.num)) {
                                    dropload.lock();// 锁定
                                    dropload.noData();// 无数据
                                    $('.dropload-down').hide();
                                }
                                $('.similar-merchant').prepend(goodsListHtml);
                                // $('.dropload-down').before(goodsListHtml);
                                dropload.resetload();// 每次数据加载完，必须重置
                            }
                            if($('.release-near-art').length>0){
                                 sign=0;
                            }
                        }, 300);
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        layer.msg('网络请求延迟！');
                        console.info(XMLHttpRequest.status);
                        console.info(XMLHttpRequest.readyState);
                        console.info(textStatus);
                    },
                });
            }
            $(document).on('click','.goods-detail',function(){
                var goodsID = $(this).attr('goodsID');
                var detail_url = 'http://'+window.location.host+'/goods-details-new.html?goodsID='+goodsID;
                openH5(detail_url);
            })
            //*********************************商品搜索列表上拉加载*****************
            function dropload_goodsList(params) {
                var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                var time = toLocalTime(ts, 6);
                dropload = $('.similar-merchant').dropload({
                    scrollArea: window,
                    domUp: {
                        domClass: 'dropload-up',
                        domRefresh: '<div class="dropload-refresh"><p style="height:20px;">↓下拉刷新</p><p style="color:#666">上次更新:' + time + '</p></div>',
                        domUpdate: '<div class="dropload-update"><p style="height:20px;">↑释放更新</p><p style="color:#666">上次更新:' + time + '</p></div>',
                        domLoad: '<div class="dropload-load"><span class="loading"></span>刷新中...</div>'
                    },
                    domDown: {
                        domClass: 'dropload-down',
                        domRefresh: '<div class="dropload-refresh"></div>',
                        domLoad: '<div class="dropload-load"><span class="loading"></span>加载中...</div>',
                        domNoData: '<div class="dropload-noData">已加载全部数据</div>'
                    },
                    loadUpFn: function (me) {
                        //下拉刷新
                        params.page = 0;
                        goodsList(params);
                        params.page = 1;
                    },
                    loadDownFn: function (me) {
                        //上拉加载
                        goodsList(params);
                        params.page++;
                    },
                    threshold: 50
                });
            }
            var goodsCount = 0;  //已加载条数
                function get_myGoods(params) {//获取我的商品
                    var cmd = 'myGoods';//接口命令
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var jsonp = 1;
                    var up = 1;//默认是上拉
                    if (params.page == 0) {
                        up = 0;
                        goodsCount = 0;
                        params.page = 1;
                    }
                    params = objKeySort(params);//按照属性名升序排列
                    var params_str = objChangeStr(params);//拼接params参数的属性值
                    params.verify = $.md5(cmd + ts + params_str + 'security');//生成验证码           
                    $.ajax({
                        url: apiURL, //接口地址
                        data: {'cmd': cmd, 'ts': ts, 'params': params, 'jsonp': jsonp},
                        dataType: 'jsonp',
                        success: function (data) {
                            console.info(data);
                            if (isNull(data['body']['list'])) {
                                var search_html = '';
                                var orderStatus = '';
                                var css_type = '';
                                $.each(data['body']['list'], function (i, val) {
                                    if(goodsID!=val['goodsID']){
                                    var comment_star = showStar(data['body']['grade']);//星标评论
                                    //<a href="goods-details.html?goodsID='+val['goodsID']+'&from=h5">
                                    search_html += '<article class="release-near-art ovw">'+
                                                        '<a href="goods-details-new.html?from=merchant&goodsID='+val['goodsID']+'"><dl class="release-near-dl ovw">'+
                                                            '<dt><img src="' + val['poster'] + '"/><span class="rele-near-name fl ovw"> ' + val['publisherName'] + '</span></dt>'+
                                                            '<dd>'+
                                                                '<div class="rele-near-dete ovw">'+
                                                                    '<div class="near-discuse ovw fl">'+
                                                                        '<p class="star-eval ovw fr">'+comment_star+'</p>'+
                                                                        '<cite class="fr">评价:</cite>'+
                                                                    '</div>'+
                                                                '</div>'+
                                                                '<p class="near-pa ovw">'+
                                                                    '<label class="fl">发布时间：</label>'+
                                                                    '<samp class="fl">' + val['timeline'] + '</samp>'+
                                                                '</p>'+
                                                                '<p class="near-pa ovw">'+
                                                                    '<label class="fl">商品：</label>'+
                                                                    '<span class="fl">' + val['goodsName'] + '</span>'+
                                                                '</p>'+
                                                                '<p class="near-pa ovw">'+
                                                                    '<label class="fl">价格：</label>'+
                                                                    '<samp class="fl">¥' + val['goodsPrice'] + '</samp>'+
                                                                '</p>'+
                                                            '</dd>'+
                                                        '</dl></a>'+
                                                    '</article>';
                                    goodsCount++;
                                    }else{
                                        if(data['body']['list'].length==1){
                                            search_html = '<div class="none-more-content" style="background: white;">暂无内容</div>';
                                        }else{
                                            search_html += '';
                                        }
                                    }
                                });
                            } else {
                                if ((goodsCount != 0)) {//上拉加载无内容锁定无数据
                                    dropload.resetload();
                                    dropload.lock();
                                    dropload.noData();
                                    $('.dropload-down').hide();
                                } else {
                                    html = '<div class="none-more-content" style="background:#fff">暂无内容</div>';
                                    $('.dropload-down').siblings().remove();
                                    $('.dropload-down').before(html);
//                                    $('.similar-goods').html(html);
                                    dropload.resetload();
                                    dropload.lock();
                                    dropload.noData();
                                    $('.dropload-down').hide();
                                    return false;
                                }
                            }
                            // 为了测试，延迟1秒加载
                            setTimeout(function () {
                                $('.none-more-content').remove();
                                if (up == 0) {//下拉加载
                                    if (goodsCount < ((params.page) * params.num) && goodsCount != 0) {
                                        search_html += '<div class="dropload-down"><div class="dropload-noData">加载完成</div></div>';
                                        $('.ms-contents').html(search_html);
                                    } else {
                                        $('.ms-contents').html(search_html);
                                        dropload_machineList(params);
                                    }
                                    dropload.resetload();
                                    dropload.unlock();// 解锁loadDownFn里锁定的情况
                                    //dropload.noData(false);
                                    $('.dropload-down').hide();
                                    params.page = 2;// 重置页数，重新获取loadDownFn的数据
                                } else {
                                    if (goodsCount < ((params.page) * params.num)) {
                                        dropload.lock();// 锁定
                                        dropload.noData();// 无数据
                                        $('.dropload-down').hide();
                                    }
                                    $('.similar-goods').prepend(search_html);
//                                    $('.dropload-down').before(search_html);
                                    dropload.resetload();// 每次数据加载完，必须重置
                                }
                            }, 500);
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg('网络请求延迟！');
                            console.info(XMLHttpRequest.status);
                            console.info(XMLHttpRequest.readyState);
                            console.info(textStatus);
                        },
                    });
                }
                //*********************************我的商品列表上拉加载*****************
                function dropload_machineList(params) {
                    var ts = parseInt(new Date().getTime() / 1000);//当前时间戳
                    var time = toLocalTime(ts, 6);//下拉时间定义
                    dropload = $('.p_info_show').dropload({
                        scrollArea: window,
                        domUp: {
                            domClass: 'dropload-up',
                            domRefresh: '<div class="dropload-refresh"><p style="height:20px;">↓下拉刷新</p><p style="color:#666">上次更新:' + time + '</p></div>',
                            domUpdate: '<div class="dropload-update"><p style="height:20px;">↑释放更新</p><p style="color:#666">上次更新:' + time + '</p></div>',
                            domLoad: '<div class="dropload-load"><span class="loading"></span>刷新中...</div>'
                        },
                        domDown: {
                            domClass: 'dropload-down',
                            domRefresh: '<div class="dropload-refresh"></div>',
                            domLoad: '<div class="dropload-load"style="background:#fff"><span class="loading"></span>加载中...</div>',
                            domNoData: '<div class="dropload-noData" style="background:#fff">已加载全部数据</div>'
                        },
                        loadUpFn: function (me) {
                            //下拉刷新
                            params.page = 0;
                            get_myGoods(params);
                            params.page = 1;
                        },
                        loadDownFn: function (me) {
                            //上拉加载
                            get_myGoods(params);
                            params.page++;
                        },
                        threshold: 50
                    });
                }

                // });
            }, 200)
        </script>
    </body>
</html>
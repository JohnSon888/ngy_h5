<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title></title>
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/demo.css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/flexible.js"></script>
    <script type="text/javascript" src="src/lib/jquery/jquery.md5.js"></script>
    <script type="text/javascript" src="src/lib/common/common.js"></script>
    <script type="text/javascript" src="src/lib/jedate/jedate.js"></script>
    <script type="text/javascript" src="src/lib/common/farming.js"></script>
    <script type="text/javascript" src="src/lib/common/public.js"></script>
    <script type="text/javascript" src="src/lib/public/public.js"></script>



    <!-- layer -->
    <script type="text/javascript" src="src/lib/layer/layer.js"></script>
    <style type="text/css">
    .personal-ula li:first-child {
            line-height: 1.173rem;
    height: 1.173rem;
    }
    .personal-ula .none-right-arrow{
    	background: none;
    }
    .personal-ula .none-right-arrow .personal-some {
	    padding-right: 0.44rem;
}
.help-center {
    background: #fff;
    width: 96%;
    padding-left: 0.37rem;
}
.personal-ula li .help-name {
     text-indent: 0rem; 
}
.release-intro{
    height: 6.66rem;
    margin-left: 0.37rem;
    margin-top: 0.37rem;
    border-bottom: 1px solid #ececec;
}
.release-intro .merchants-text {
    display: block;
    width: 100%;
    height: 68%;
    position: relative;
    left: 0;
    bottom: 0;
    z-index: 22;
}
.none-right-arrow input{
    height: 1.173rem;
}
.plant-imgb{
    margin-left: 0;
}
#datepicker{height:100%;}
div#jedatebox{
    top:20%;
    left:5%;
    width:90%;
    font-size: 22px;
}
.release-dialog {
        display: none;
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 280px;
        height: 90px;
        z-index: 1000;
        left: 50%;
        margin-left: -140px;
    }

    .release-dialog .content {
        position: relative;
        margin-top: 170px;
    }

    .release-dialog .release-content {
        width: 280px;
        height: 90px;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        border: 1px solid #ccc;
        border-radius: 6px;
        margin: 0 auto;
        margin-bottom: 0.5rem;
        background: #fff;
    }

    .release-dialog .release-content .release-img {
        width: 68px;
        height: 55px;
        margin-left: 0.5rem;
        margin-right: 0.5rem;
    }

    .release-dialog .release-content .release-img img {
        width: 100%;
        height: 100%;
    }

    .release-dialog .release-content p {
        font-size: 13px;
        color: #000;
    }

    .release-dialog .release-content .release-title {
        font-size: 20px;
    }

    .release-dialog .release-content .release-subTitle {
        color: #888;
    }

    .mask {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 999;
        background: #000;
        opacity: 0.4;
        display: none;
    }
</style>
</head>

<body>
    <section class="body-bj">
        <section class="header ovw posin">本地招聘发布<a href="javascript:;" class="header-back ovw"></a></section>
        <section class="add-subs ovw">
            <div class="release-intro">
            	<textarea id="detail" class="merchants-text ovw description" placeholder="请输入发布内容..."></textarea>
                <p>
                    <span class="fl plant-imgb ovw old_pic old-pic-add"><img src="images/plant_2.png"></span>
                </p>
            </div>
            <ul class="help-center personal-ula ovw btzl">
                <li class="none-right-arrow">
                    <label class="help-name ovw">联系人</label><input id="concat" class="personal-some ovw" placeholder="请输入联系人姓名"></input></li>
                <li class="none-right-arrow">
                    <label class="help-name ovw">电话</label><input id="phone" class="personal-some ovw" placeholder="请输入电话号码"></input></li>
                <li class="none-right-arrow">
                    <label class="help-name ovw">地点</label>
                    <samp class="personal-some ovw">请选择地点</samp>
                </li>
                <li class="none-right-arrow">
                    <input id="address" class="help-name ovw" placeholder="请输入具体位置"></input>
                </li>
            </ul>
            <a id="fabu" class="over-order ovw topic_tj" href="javascript:;">发布</a>
        </section>
    </section>
    <div class="mask"></div>
    <div class="release-dialog">
        <div class="content">
            <div class="release-content">
                <div class="release-img">
                    <img src="images/img1.png">
                </div>
                <div class="release-now">
                    <p class="release-title">立即发布</p>
                    <p class="release-subTitle">我已填写完成，立即发布</p>
                </div>
            </div>
            <div class="release-content">
                <div class="release-img">
                    <img src="images/img2.png">
                </div>
                <div class="complete-info">
                    <p class="release-title">完善信息</p>
                    <p class="release-subTitle">我还有内容需要添加，继续填写</p>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
    // function GetQueryString(name)
    // {
    //      var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
    //      var r = window.location.search.substr(1).match(reg);
    //      if(r!=null)return  unescape(r[2]); return null;
    // };
    // var userid = GetQueryString(userid)
    // var pulishID = GetQueryString(pulishID)
   // var userid = 1;
    get_userInfo(userid);
    //获得用户信息
    function get_userInfo(userid){
        if (!userid) {
            layer.msg('请重新登录！');return
        }
        var cmd = 'userInfo';//接口命令
        var ts = parseInt(new Date().getTime()/1000);//当前时间戳
        var jsonp = 1;
        var params = {
                'userid' : userid,
                };
        params = objKeySort(params);//按照属性名升序排列
        var params_str = objChangeStr(params);//拼接params参数的属性值
        params.verify = $.md5(cmd+ts+params_str+'security');//生成验证码           
        $.ajax({
            url : 'http://ngy.innke.net/api/index.php',//接口地址
            data : {'cmd':cmd, 'ts':ts, 'params':params, 'jsonp':jsonp},
            dataType : 'jsonp',
            success: function(data){
               $('#concat').val(data.body.truename);
               $('#phone').val(data.body.phone);
               console.log(data);
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                layer.msg('网络请求延迟！');
                console.info(XMLHttpRequest.status);
                console.info(XMLHttpRequest.readyState);
                console.info(textStatus);
            },
        });
    }

    var apiURL = 'http://ngy.innke.net/apiv2/index.php'
        $('#fabu').click(function(){
            $('.mask').show();
            $('.release-dialog').show();
        })

         $('.mask').click(function() {
            $(this).hide();
            $('.release-dialog').hide();
        });
    // 立即发布
        $('.release-now').click(function() {
            mech_publishInfo('back');
        });
        // 完善信息
        $('.complete-info').click(function() {
            mech_publishInfo('go');            
        });
    function mech_publishInfo(opt){
            var cmd  = 'publishInfo';
            var ts = parseInt(new Date().getTime() / 1000); 
            var jsonp = 1;
            
            var name = $('#concat').val();
            var phone = $('#phone').val();
            var detail = $('#detail').val()||'测试';
            var address = $('#address').val()||'测试地址';
            var province = '1';
            var city = '1';
            var area = '1';
            var town = '1';
            var village = '1';
            var images = '1'

            //出发时间接口没有
            // var time = $('#datepicker').val();
            var params = {
                userid:userid,
                type:2,
                detail:detail,
                verify:'',
                images:images,
                name:name,
                phone:phone,
                province:province,
                city:city,
                area:area,
                town:town,
                village:village,
                address:address,
            }
            params = objKeySort(params);//按照属性名升序排列
            var params_str = objChangeStr(params);//拼接params参数的属性值
            params.verify = $.md5(cmd+ts+params_str+'security');//生成验证码
            console.log(params);
             $.ajax({
                    url : apiURL,//接口地址
                data : {'cmd':cmd, 'ts':ts, 'params':params, 'jsonp':jsonp,type:'2'},
                dataType : 'jsonp',
                success: function(data){
                    console.log(data);
                    if(data.resultCode=='-1'){
                        layer.msg(data.resultMessage);
                    }else{
                        if (opt=='go') {
                            setTimeout(function(){
                                location.href = 'local-invite-complete.html?userid='+userid+'&pulishID='+data.body.publishID;
                            },500);     
                        }else{
                            layer.msg('发布成功');
                            backtoNative();
                            $('.mask').hide();
                            $('.release-dialog').hide();
                        }
                        
                    }
                },
                error: function(XMLHttpRequest, textStatus, errorThrown){
                    layer.msg('网络请求延迟！');
                    console.info(XMLHttpRequest.status);
                    console.info(XMLHttpRequest.readyState);
                    console.info(textStatus);
                },
            });
        }
    </script>
</body>

</html>
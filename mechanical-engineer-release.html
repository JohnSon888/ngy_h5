<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <title></title>
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/demo.css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/flexible.js"></script>
    <script type="text/javascript" src="src/lib/jquery/jquery.md5.js"></script>
    <script type="text/javascript" src="src/lib/common/common.js"></script>
    <!-- layer -->
    <script type="text/javascript" src="src/lib/layer/layer.js"></script>
    <style type="text/css">
    .personal-ula li:first-child {
        line-height: 1.173rem;
        height: 1.173rem;
    }

    .personal-ula .none-right-arrow {
        background: none;
    }

    .personal-ula .none-right-arrow .personal-some {
        padding-right: 0.44rem;
        height: 100%;
    }

    .help-center {
        background: #fff;
        width: 96%;
        padding-left: 0.37rem;
    }

    .personal-ula li .help-name {
        text-indent: 0rem;
    }

    .release-intro {
        height: 3.66rem;
        margin-left: 0.37rem;
        margin-top: 0.37rem;
        border-bottom: 1px solid #ececec;
    }

    .release-intro .merchants-text {
        display: block;
        width: 100%;
        height: 100%;
        position: relative;
        left: 0;
        bottom: 0;
        z-index: 22;
    }

    .help-center li {
        overflow: initial;
    }

    .choise {
        position: relative;
    }

    .pplist {
        border: 1px solid #dcdcdc;
        display: none;
        position: absolute;
        top: 1.173rem;
        left: 0;
        width: 100%;
        z-index: 99;
    }

    .ppitem {
        height: 1.173rem;
        line-height: 1.173rem;
        padding-right: 0.84rem;
        background: #fff;
        border-bottom: 1px solid #fff;
        background: #dcdcdc;
        color: #fff;
    }

    .ppitem:last-child {
        border-bottom: none;
    }

    .release-dialog {
        display: none;
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 280px;
        height: 90px;
        z-index: 1000;
        left: 50%;
        margin-left: -140px;
    }

    .release-dialog .content {
        position: relative;
        margin-top: 170px;
    }

    .release-dialog .release-content {
        width: 280px;
        height: 90px;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        border: 1px solid #ccc;
        border-radius: 6px;
        margin: 0 auto;
        margin-bottom: 0.5rem;
        background: #fff;
    }

    .release-dialog .release-content .release-img {
        width: 68px;
        height: 55px;
        margin-left: 0.5rem;
        margin-right: 0.5rem;
    }

    .release-dialog .release-content .release-img img {
        width: 100%;
        height: 100%;
    }

    .release-dialog .release-content p {
        font-size: 13px;
        color: #000;
    }

    .release-dialog .release-content .release-title {
        font-size: 20px;
    }

    .release-dialog .release-content .release-subTitle {
        color: #888;
    }

    .mask {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 999;
        background: #000;
        opacity: 0.4;
        display: none;
    }
    </style>
</head>

<body>
    <section class="body-bj">
        <section class="header ovw posin">农机机械发布<a href="javascript:;" class="header-back ovw"></a></section>
        <section class="add-subs " style="overflow: initial;">
            <ul class="help-center personal-ula btzl">
                <li class="none-right-arrow">
                    <label class="help-name ovw">报价</label>
                    <input id="price" placeholder="请填写价格" class="personal-some ovw">
                </li>
                <li>
                    <label class="help-name ovw">类型</label>
                    <div class="personal-some choise"><span id="type">请选择</span>
                        <div class="pplist">
                        </div>
                    </div>
                </li>
                <li>
                    <label class="help-name ovw">状态</label>
                    <div class="personal-some choise"><span id="status">请选择</span>
                        <div class="pplist">
                        </div>
                    </div>
                </li>
                <li>
                    <label class="help-name ovw">方式</label>
                    <div class="personal-some choise"><span id="fangshi">请选择</span>
                        <div class="pplist">
                        </div>
                    </div>
                </li>
            </ul>
            <a id="fabu" class="over-order topic_tj" href="javascript:;">发布</a>
        </section>
    </section>
    <div class="mask"></div>
    <div class="release-dialog">
        <div class="content">
            <div class="release-content">
                <div class="release-img">
                    <img src="images/img1.png">
                </div>
                <div class="release-now">
                    <p class="release-title">立即发布</p>
                    <p class="release-subTitle">我已填写完成，立即发布</p>
                </div>
            </div>
            <div class="release-content">
                <div class="release-img">
                    <img src="images/img2.png">
                </div>
                <div class="complete-info">
                    <p class="release-title">完善信息</p>
                    <p class="release-subTitle">我还有内容需要添加，继续填写</p>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    };
    var userid = GetQueryString(userid)
    var pulishID = GetQueryString(pulishID)
    var apiURL = 'http://ngy.innke.net/apiv2/index.php'

    function aj(el, type) {
        $.ajax({
            url: apiURL, //接口地址
            data: { 'cmd': 'inviteSelectInfo', 'userid': userid, 'ts': parseInt(new Date().getTime() / 1000), 'params': { type: type }, 'jsonp': 1 },
            dataType: 'jsonp',
            success: function(data) {
                console.info(data);
                var data = data.body.list;
                var str = '';
                for (var i = 0; i < data.length; i++) {
                    str += '<div class="ppitem" data-id="' + data[i].infoID + '">' + data[i].infoName + '</div>'
                }
                el.html(str)
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                layer.msg('网络请求延迟！');
                console.info(XMLHttpRequest.status);
                console.info(XMLHttpRequest.readyState);
                console.info(textStatus);
            },
        });
    }
    aj($('.pplist').eq(0), 7)
    aj($('.pplist').eq(1), 8)
    aj($('.pplist').eq(2), 9)
    $('.choise').click(function() {
        $(this).find('.pplist').slideToggle();
    })
    $('.choise').on('click', '.ppitem', function(e) {
        e.stopPropagation();
        var val = $(this).text();
        $(this).parents('.choise').find('span').text(val)
        $(this).parents('.choise').find('.pplist').slideToggle();
    })
    $('#fabu').click(function() {

        $('.mask').show();
        $('.release-dialog').show();

        // var cmd  = 'mechanicalPublish';
        // var ts = parseInt(new Date().getTime() / 1000); 
        // var jsonp = 1;

        // var price = $('#price').val();
        // var type = $('#type').text();
        // var status = $('#status').text();
        // var way = $('#fangshi').text();
        // if(price==''){
        //     layer.msg('请填写价格');
        //     return;
        // }
        // if(type=='请选择'){
        //     layer.msg('请选择类型');
        //     return;
        // }
        // if(status=='请选择'){
        //     layer.msg('请选择状态');
        //     return;
        // }
        // if(way=='请选择'){
        //     layer.msg('请选择方式');
        //     return;
        // }
        // var params = {
        //     'userid':userid,
        //     pulishID:pulishID,
        //     verify:'',
        //     price:price,
        //     type:'type',
        //     status:'status',
        //     way:'way',
        // }
        //  $.ajax({
        //      url : apiURL,//接口地址
        //     data : {'cmd':cmd, 'ts':ts, 'params':params, 'jsonp':jsonp},
        //     dataType : 'jsonp',
        //     success: function(data){
        //         if(data.resultCode=='-1'){
        //             layer.msg(data.resultMessage);
        //         }else{
        //             layer.msg('发布成功');
        //         }
        //     },
        //     error: function(XMLHttpRequest, textStatus, errorThrown){
        //         layer.msg('网络请求延迟！');
        //         console.info(XMLHttpRequest.status);
        //         console.info(XMLHttpRequest.readyState);
        //         console.info(textStatus);
        //     },
        // });
    })
    $('.mask').click(function() {
            $(this).hide();
            $('.release-dialog').hide();
        });
    // 立即发布
    $('.release-now').click(function() {
        // 调接口
        var cmd  = 'mechanicalPublish';
        var ts = parseInt(new Date().getTime() / 1000); 
        var jsonp = 1;

        var price = $('#price').val();
        var type = $('#type').text();
        var status = $('#status').text();
        var way = $('#fangshi').text();
        if(price==''){
            layer.msg('请填写价格');
            return;
        }
        if(type=='请选择'){
            layer.msg('请选择类型');
            return;
        }
        if(status=='请选择'){
            layer.msg('请选择状态');
            return;
        }
        if(way=='请选择'){
            layer.msg('请选择方式');
            return;
        }
        var params = {
            'userid':userid,
            pulishID:pulishID,
            verify:'',
            price:price,
            type:'type',
            status:'status',
            way:'way',
        }
        params = objKeySort(params);//按照属性名升序排列
        var params_str = objChangeStr(params);//拼接params参数的属性值
        params.verify = $.md5(cmd+ts+params_str+'security');//生成验证码
         $.ajax({
             url : apiURL,//接口地址
            data : {'cmd':cmd, 'ts':ts, 'params':params, 'jsonp':jsonp},
            dataType : 'jsonp',
            success: function(data){
                if(data.resultCode=='-1'){
                    layer.msg(data.resultMessage);
                }else{
                    layer.msg('发布成功');
                }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown){
                layer.msg('网络请求延迟！');
                console.info(XMLHttpRequest.status);
                console.info(XMLHttpRequest.readyState);
                console.info(textStatus);
            },
        });
    });
    // 完善信息
    $('.complete-info').click(function() {
        
        location.href = 'local-invite-release1.html';
    });
    </script>
</body>

</html>